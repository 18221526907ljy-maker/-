<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我要看怪奇物语</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts: Playfair Display -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        .font-serif { font-family: 'Playfair Display', serif; }
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #F5F5F7; }
        ::-webkit-scrollbar-thumb { background: #D1D1D1; }
        ::-webkit-scrollbar-thumb:hover { background: #8E8E93; }

        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
    </style>
</head>
<body class="bg-[#F5F5F7] text-[#1D1D1F] font-sans selection:bg-[#E5E5E5] overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Icons handled via SVG for standalone compatibility
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                plus: <path d="M12 5v14M5 12h14" />,
                play: <path d="m5 3 14 9-14 9V3z" />,
                trash: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />,
                chevronLeft: <path d="m15 18-6-6 6-6" />,
                check: <path d="M20 6 9 17l-5-5" />,
                sparkles: <path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z" />,
                eye: (
                    <React.Fragment>
                        <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/>
                    </React.Fragment>
                ),
                layers: (
                    <React.Fragment>
                        <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/>
                        <path d="m2.6 10.33 8.58 3.9a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0 1.83l-8.58 3.91a2 2 0 0 1-1.66 0l-8.58-3.9a1 1 0 0 1 0-1.83Z"/>
                        <path d="m2.6 14.58 8.58 3.9a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0 1.83l-8.58 3.91a2 2 0 0 1-1.66 0l-8.58-3.9a1 1 0 0 1 0-1.83Z"/>
                    </React.Fragment>
                ),
                globe: (
                    <React.Fragment>
                        <circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20M2 12h20" />
                    </React.Fragment>
                ),
                wallet: (
                    <React.Fragment>
                        <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/>
                        <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4" />
                    </React.Fragment>
                ),
                arrowRight: <path d="M5 12h14m-7-7 7 7-7 7" />,
                circle: <circle cx="12" cy="12" r="10" />
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const apiKey = ""; 

        const SUBJECTS = [
            { id: 'brand', name: '品牌管理', label: 'THE LABEL', color: 'from-[#2D2D2D] to-[#1A1A1A]', icon: 'layers' },
            { id: 'marketing', name: '营销渠道', label: 'DISTRIBUTION', color: 'from-[#8E8E93] to-[#636366]', icon: 'globe' },
            { id: 'finance', name: '财务管理', label: 'CAPITAL', color: 'from-[#D4C3B3] to-[#A08E7D]', icon: 'wallet' }
        ];

        const App = () => {
            const [view, setView] = useState('home'); 
            const [activeSubject, setActiveSubject] = useState(SUBJECTS[0]);
            const [db, setDb] = useState({ brand: { questions: [], cards: [] }, marketing: { questions: [], cards: [] }, finance: { questions: [], cards: [] } });
            const [mistakes, setMistakes] = useState([]);
            const [activeItems, setActiveItems] = useState([]);
            const [currentIdx, setCurrentIdx] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [quizAnswered, setQuizAnswered] = useState(false);
            const [selectedIdx, setSelectedIdx] = useState(null);
            const [rawText, setRawText] = useState('');
            const [isParsing, setIsParsing] = useState(false);
            const [importType, setImportType] = useState('question');

            const parseData = async () => {
                if (!rawText.trim()) return;
                setIsParsing(true);
                const systemPrompt = importType === 'question' 
                    ? `将文本解析为考试题目JSON数组: [{type: 'single'|'multiple'|'open', question, options[], correct, logic}]。专业简洁。`
                    : `将文本解析为闪卡JSON数组: [{front, back, logic}]。极简高级。`;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `解析以下${importType}内容：\n${rawText}` }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const result = await response.json();
                    const parsed = JSON.parse(result.candidates[0].content.parts[0].text);
                    const newItems = parsed.map(item => ({ ...item, id: Math.random().toString(36).substr(2, 9), status: null }));
                    setDb(prev => ({
                        ...prev,
                        [activeSubject.id]: {
                            ...prev[activeSubject.id],
                            [importType === 'question' ? 'questions' : 'cards']: [...prev[activeSubject.id][importType === 'question' ? 'questions' : 'cards'], ...newItems]
                        }
                    }));
                    setRawText('');
                    setView('home');
                } catch (e) { console.error(e); } finally { setIsParsing(false); }
            };

            const startSession = (mode, type) => {
                let pool = type === 'cards' ? db[activeSubject.id].cards : db[activeSubject.id].questions;
                if (mode === 'forgotten') pool = pool.filter(c => c.status === 'forgotten');
                if (mode === 'blurred') pool = pool.filter(c => c.status === 'blurred');
                if (pool.length === 0) return;
                setActiveItems([...pool].sort(() => Math.random() - 0.5));
                setCurrentIdx(0); setIsFlipped(false); setQuizAnswered(false); setSelectedIdx(null); setView(type);
            };

            const handleQuizAnswer = (idx) => {
                if (quizAnswered) return;
                setSelectedIdx(idx); setQuizAnswered(true);
                const q = activeItems[currentIdx];
                if (idx !== q.correct) setMistakes(prev => prev.find(m => m.id === q.id) ? prev : [...prev, q]);
            };

            const updateCardStatus = (status) => {
                const cardId = activeItems[currentIdx].id;
                setDb(prev => ({
                    ...prev,
                    [activeSubject.id]: {
                        ...prev[activeSubject.id],
                        cards: prev[activeSubject.id].cards.map(c => c.id === cardId ? { ...c, status } : c)
                    }
                }));
                if (currentIdx + 1 < activeItems.length) { setCurrentIdx(c => c + 1); setIsFlipped(false); } 
                else setView('home');
            };

            return (
                <div className="min-h-screen">
                    <div className="fixed inset-0 pointer-events-none z-0">
                        <div className="absolute top-0 right-0 w-1/2 h-1/2 bg-gradient-to-bl from-gray-200/40 to-transparent blur-[120px]"></div>
                        <div className="absolute bottom-0 left-0 w-1/2 h-1/2 bg-gradient-to-tr from-[#D4C3B3]/20 to-transparent blur-[120px]"></div>
                    </div>

                    <nav className="relative z-10 flex justify-between items-center p-8 px-12 border-b border-gray-200 bg-white/40 backdrop-blur-xl">
                        <div className="flex items-center gap-6 cursor-pointer" onClick={() => setView('home')}>
                            <h1 className="text-2xl font-light tracking-[0.4em] uppercase border-b border-black pb-1">Archive</h1>
                            <span className="text-[10px] font-medium tracking-[0.2em] text-gray-400 mt-2">STUDY EDIT</span>
                        </div>
                        <button onClick={() => setView('burnbook')} className="text-[11px] font-bold tracking-widest uppercase hover:opacity-50 transition-opacity flex items-center gap-2">
                            The Archive ({mistakes.length})
                        </button>
                    </nav>

                    <main className="relative z-10 max-w-6xl mx-auto px-6 py-16">
                        {view === 'home' && (
                            <div className="space-y-24 animate-in">
                                <header className="space-y-6 text-center">
                                    <h2 className="text-7xl md:text-9xl font-light tracking-tighter leading-none italic font-serif">Effortless.</h2>
                                    <p className="text-xs font-bold uppercase tracking-[0.6em] text-gray-400">Master your craft with intention</p>
                                </header>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-12">
                                    {SUBJECTS.map((sub) => (
                                        <div key={sub.id} className="group relative space-y-8 p-4 transition-all hover:-translate-y-2">
                                            <div className={`aspect-[3/4] rounded-sm bg-gradient-to-br ${sub.color} shadow-2xl relative overflow-hidden flex flex-col justify-end p-8 text-white`}>
                                                <div className="absolute top-8 right-8 opacity-40"><Icon name={sub.icon} /></div>
                                                <div className="relative z-10 space-y-2">
                                                    <span className="text-[10px] font-bold tracking-[0.4em] opacity-60 uppercase">{sub.label}</span>
                                                    <h3 className="text-4xl font-light tracking-tight italic font-serif">{sub.name}</h3>
                                                </div>
                                            </div>
                                            <div className="space-y-6 px-2">
                                                <div className="flex justify-between text-[10px] font-bold tracking-widest text-gray-400 border-b border-gray-100 pb-2 uppercase">
                                                    <span>Data Pool</span>
                                                    <span className="text-black font-medium">{db[sub.id].questions.length + db[sub.id].cards.length} Items</span>
                                                </div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <button onClick={() => { setActiveSubject(sub); startSession('all', 'questions'); }} className="py-4 bg-black text-white text-[10px] font-bold tracking-widest uppercase hover:bg-gray-800 transition shadow-lg">Practice</button>
                                                    <button onClick={() => { setActiveSubject(sub); setView('flash-options'); }} className="py-4 border border-black text-black text-[10px] font-bold tracking-widest uppercase hover:bg-black hover:text-white transition">Cards</button>
                                                </div>
                                                <button onClick={() => { setActiveSubject(sub); setView('input'); }} className="w-full text-[10px] font-bold tracking-widest text-gray-300 hover:text-black transition uppercase">+ Import Notes</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'flash-options' && (
                            <div className="max-w-xl mx-auto space-y-12 animate-in">
                                <button onClick={() => setView('home')} className="flex items-center gap-4 text-gray-400 font-bold uppercase text-[10px] tracking-widest hover:text-black"><Icon name="chevronLeft" size={16} /> Back</button>
                                <div className="bg-white p-12 border border-gray-100 shadow-sm space-y-10 text-center">
                                    <h2 className="text-3xl font-light italic font-serif">Focus Session</h2>
                                    <div className="space-y-4">
                                        {['all', 'forgotten', 'blurred'].map(mode => (
                                            <button key={mode} onClick={() => startSession(mode, 'cards')} className="w-full group flex justify-between items-center py-4 border-b border-gray-100 hover:border-black transition-all">
                                                <span className="text-[11px] font-bold tracking-[0.3em] uppercase">{mode} Signals</span>
                                                <span className="text-[10px] text-gray-300 group-hover:text-black">
                                                    {mode === 'all' ? db[activeSubject.id].cards.length : db[activeSubject.id].cards.filter(c => c.status === mode).length} Items
                                                </span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'input' && (
                            <div className="max-w-4xl mx-auto animate-in">
                                <button onClick={() => setView('home')} className="mb-10 flex items-center gap-4 text-gray-400 font-bold uppercase text-[10px] tracking-widest hover:text-black"><Icon name="chevronLeft" size={16} /> Cancel</button>
                                <div className="bg-white p-12 border border-gray-100 shadow-sm space-y-12">
                                    <div className="flex justify-between items-end">
                                        <div>
                                            <span className="text-[10px] font-bold text-gray-300 uppercase tracking-widest">Workspace</span>
                                            <h2 className="text-4xl font-light italic font-serif">Import: {activeSubject.name}</h2>
                                        </div>
                                        <div className="flex border border-gray-100 p-1">
                                            {['question', 'card'].map(t => (
                                                <button key={t} onClick={() => setImportType(t)} className={`px-8 py-3 text-[10px] font-bold tracking-widest uppercase transition-all ${importType === t ? 'bg-black text-white' : 'text-gray-300'}`}>{t}s</button>
                                            ))}
                                        </div>
                                    </div>
                                    <textarea value={rawText} onChange={(e) => setRawText(e.target.value)} placeholder="Paste content here..." className="w-full h-80 bg-[#FAFAFA] border-none p-10 outline-none text-sm font-medium leading-relaxed resize-none shadow-inner" />
                                    <button disabled={isParsing || !rawText} onClick={parseData} className="w-full py-6 bg-black text-white text-[11px] font-bold tracking-[0.4em] uppercase hover:bg-gray-800 disabled:opacity-20 transition-all flex items-center justify-center gap-4">
                                        {isParsing ? <Icon name="sparkles" className="animate-spin" /> : <Icon name="sparkles" />} {isParsing ? 'Processing' : 'Generate Edit'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'questions' && (
                            <div className="max-w-3xl mx-auto animate-in">
                                <div className="flex justify-between items-end mb-12">
                                    <span className="text-[10px] font-bold uppercase tracking-[0.5em] text-gray-300">Section {currentIdx + 1} // {activeItems.length}</span>
                                    <button onClick={() => setView('home')} className="text-[10px] font-bold uppercase text-gray-300 hover:text-black">Quit</button>
                                </div>
                                <div className="bg-white border border-gray-100 p-12 md:p-20 space-y-16 shadow-lg relative">
                                    <div className="absolute top-0 left-0 h-1 bg-black transition-all duration-700" style={{ width: `${((currentIdx+1)/activeItems.length)*100}%` }}></div>
                                    <p className="text-4xl font-light italic font-serif leading-tight text-gray-900">{activeItems[currentIdx].question}</p>
                                    <div className="space-y-4">
                                        {activeItems[currentIdx].type !== 'open' ? (
                                            activeItems[currentIdx].options.map((opt, i) => {
                                                const isCorrect = i === activeItems[currentIdx].correct;
                                                const isSel = selectedIdx === i;
                                                let style = "border-gray-50 bg-[#FAFAFA] hover:bg-gray-100";
                                                if (quizAnswered) {
                                                    if (isCorrect) style = "border-black bg-black text-white";
                                                    else if (isSel) style = "border-gray-200 bg-gray-50 text-gray-300";
                                                    else style = "opacity-20";
                                                }
                                                return (
                                                    <button key={i} disabled={quizAnswered} onClick={() => handleQuizAnswer(i)} className={`w-full text-left p-6 border text-sm font-medium transition-all flex justify-between items-center ${style}`}>
                                                        {opt} {quizAnswered && isCorrect && <Icon name="check" size={16} />}
                                                    </button>
                                                )
                                            })
                                        ) : (
                                            <div className="space-y-8">
                                                {!quizAnswered ? (
                                                    <button onClick={() => setQuizAnswered(true)} className="w-full py-20 border border-dashed border-gray-200 text-gray-300 font-bold uppercase tracking-[0.3em] hover:text-black transition-all flex flex-col items-center gap-4"><Icon name="eye" size={24} /> Reveal Insight</button>
                                                ) : (
                                                    <div className="p-10 bg-[#FAFAFA] border border-gray-100 shadow-inner">
                                                        <span className="text-[10px] font-bold text-gray-300 uppercase mb-4 block tracking-widest">Archive Answer:</span>
                                                        <p className="text-xl font-light italic font-serif leading-relaxed">"{activeItems[currentIdx].correct}"</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    {quizAnswered && (
                                        <div className="pt-12 border-t border-gray-50 space-y-10">
                                            <div className="text-[11px] leading-loose text-gray-400 italic">"Note: {activeItems[currentIdx].logic}"</div>
                                            <button onClick={() => { if(currentIdx+1 < activeItems.length) { setCurrentIdx(c => c + 1); setQuizAnswered(false); setSelectedIdx(null); } else setView('home'); }} className="w-full py-6 bg-black text-white text-[11px] font-bold tracking-[0.4em] uppercase hover:bg-gray-800 transition flex items-center justify-center gap-4">Proceed <Icon name="arrowRight" size={16}/></button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {view === 'cards' && (
                            <div className="max-w-2xl mx-auto animate-in">
                                <div className="flex justify-between items-center mb-10">
                                    <span className="text-[10px] font-bold uppercase tracking-[0.5em] text-gray-300">Look {currentIdx + 1} / {activeItems.length}</span>
                                    <button onClick={() => setView('home')} className="text-[10px] text-gray-300 hover:text-black">Close</button>
                                </div>
                                <div className="perspective-1000">
                                    <div onClick={() => setIsFlipped(!isFlipped)} className={`relative h-[550px] w-full transition-all duration-1000 preserve-3d cursor-pointer ${isFlipped ? 'rotate-y-180' : ''}`}>
                                        <div className="absolute inset-0 backface-hidden bg-white border border-gray-100 shadow-xl p-16 flex flex-col items-center justify-center text-center">
                                            <div className="absolute top-12 left-1/2 -translate-x-1/2"><Icon name="circle" size={12} className="text-gray-100" /></div>
                                            <p className="text-3xl font-light italic font-serif text-gray-900 leading-snug">{activeItems[currentIdx].front}</p>
                                            <span className="absolute bottom-16 font-bold text-[9px] text-gray-200 tracking-[0.5em] uppercase">Click to Reveal</span>
                                        </div>
                                        <div className="absolute inset-0 backface-hidden rotate-y-180 bg-black border border-black p-16 flex flex-col items-center justify-center text-center shadow-2xl">
                                            <p className="text-4xl font-light italic font-serif text-white leading-tight mb-10">{activeItems[currentIdx].back}</p>
                                            <p className="text-[11px] text-gray-500 leading-loose italic">"{activeItems[currentIdx].logic}"</p>
                                        </div>
                                    </div>
                                </div>
                                <div className={`mt-16 flex gap-6 transition-all duration-1000 ${isFlipped ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                                    <button onClick={() => updateCardStatus('forgotten')} className="flex-1 py-5 border border-gray-100 text-[10px] font-bold uppercase hover:bg-black hover:text-white transition">Forgotten</button>
                                    <button onClick={() => updateCardStatus('blurred')} className="flex-1 py-5 border border-gray-100 text-[10px] font-bold uppercase hover:bg-black hover:text-white transition">Blurred</button>
                                    <button onClick={() => updateCardStatus('mastered')} className="flex-1 py-5 bg-black text-white text-[10px] font-bold uppercase transition">Mastered</button>
                                </div>
                            </div>
                        )}

                        {view === 'burnbook' && (
                            <div className="max-w-5xl mx-auto animate-in">
                                <header className="flex justify-between items-end mb-20 border-b border-gray-200 pb-10">
                                    <h2 className="text-6xl font-light italic font-serif">The Archive</h2>
                                    <button onClick={() => setView('home')} className="text-[10px] font-bold uppercase tracking-[0.4em] hover:opacity-50">Return</button>
                                </header>
                                {mistakes.length === 0 ? (
                                    <div className="text-center py-40 border border-dashed border-gray-100 text-gray-200 uppercase tracking-[0.6em]">Clean Slate</div>
                                ) : (
                                    <div className="grid gap-12">
                                        {mistakes.map((m, i) => (
                                            <div key={i} className="bg-white border border-gray-50 p-12 hover:shadow-xl group transition-all">
                                                <div className="flex justify-between mb-8">
                                                    <span className="text-[9px] font-bold tracking-[0.5em] text-gray-300 uppercase">Entry {i+1}</span>
                                                    <button onClick={() => setMistakes(prev => prev.filter(item => item.id !== m.id))} className="text-gray-200 hover:text-black"><Icon name="trash" size={16} /></button>
                                                </div>
                                                <p className="text-3xl font-light italic font-serif text-gray-900 mb-10">{m.question}</p>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                                                    <div className="space-y-4 border-l border-black pl-6">
                                                        <span className="text-[9px] font-bold text-gray-300 uppercase tracking-widest block">Reference</span>
                                                        <p className="text-lg font-medium text-gray-700 italic">{m.type === 'open' ? m.correct : m.options[m.correct]}</p>
                                                    </div>
                                                    <div className="space-y-4 text-xs text-gray-400">
                                                        <span className="text-[9px] font-bold text-gray-300 uppercase tracking-widest block">Context</span>
                                                        <p>"{m.logic}"</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
